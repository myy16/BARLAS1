#------------------------------------------------------------
# Config file for the "RBPF-SLAM" application - YDLidar X4 Pro
# Optimized for large robot (122x119 cm) with encoder odometry
#------------------------------------------------------------

#=======================================================
# Section: [MappingApplication]
# Global parameters for the app
#=======================================================
[MappingApplication]
CAMERA_3DSCENE_FOLLOWS_ROBOT=0    # Robot'u takip etme
SHOW_PROGRESS_IN_WINDOW=1

# Insertion thresholds - büyük robot için artırıldı
insertionLinDistance=0.3          # 50cm'den 30cm'ye (daha sık güncelleme)
insertionAngDistance_deg=20.0     # 25°'den 20°'ye (daha hassas)

# Localization thresholds - encoder odometry için optimize
localizeLinDistance=0.8           # 1.20m'den 0.8m'ye (encoder güvenilir)
localizeAngDistance_deg=25.0      # Açısal threshold (encoder için uygun)

# Odometry Integration Settings
use_motion_model_default_options=0  # Özel motion model kullan

#----------------------------------------------------------------------------------
# Particle Filter Algorithm
# 2: pfOptimalProposal - ICP tabanlı, encoder odometry ile uyumlu
#----------------------------------------------------------------------------------
PF_algorithm=2
adaptiveSampleSize=0              # Sabit parçacık sayısı (encoder ile daha stabil)

#----------------------------------------------------------------------------------
# Resampling Method
# 3: prSystematic - encoder odometry ile en iyi performans
#----------------------------------------------------------------------------------
resamplingMethod=3

sampleSize=100                    # Encoder güvenilir olduğu için azaltıldı (20->100)
BETA=0.50                        # Resampling threshold
max_loglikelihood_dyn_range=25   # Arttırıldı (daha geniş likelihood range)

# ========================================================
# MULTIMETRIC MAP CONFIGURATION
# ========================================================
occupancyGrid_count=1
gasGrid_count=0
landmarksMap_count=0
beaconMap_count=0
pointsMap_count=0

# Likelihood calculation - occupancy grid kullan
likelihoodMapSelection=0          # occGrid=0 (sadece grid map)

# ====================================================
# Prediction Parameters - Encoder Odometry için
# ====================================================
powFactor=0.01                    # Artırıldı (encoder verisi güvenilir)
pfAuxFilterOptimal_MaximumSearchSamples=200  # 600'den 200'ye (encoder ile gereksiz)

# ====================================================
# pfOptimalProposal Configuration
# ====================================================
pfOptimalProposal_mapSelection=0  # Gridmap kullan (scan matching)

# Adaptive sample size parameters - encoder için optimize
KLD_maxSampleSize=150
KLD_minSampleSize=25              # 15'ten 25'e (daha stabil)
KLD_binSize_XY=0.05              # 0.03'ten 0.05'e (büyük robot)
KLD_binSize_PHI_deg=2            # 1°'den 2°'ye (büyük robot)
KLD_delta=0.002                  # Biraz artırıldı
KLD_epsilon=0.4                  # 0.5'ten 0.4'e (daha hassas)

# ====================================================
# MULTIMETRIC MAP: OccGrid #00 - YDLidar X4 Pro için
# ====================================================
[MappingApplication_occupancyGrid_00_creationOpts]
resolution=0.05                  # 10cm'den 5cm'ye (YDLidar için uygun)
disableSaveAs3DObject=0

# ====================================================
# Insertion Options - YDLidar X4 Pro specifications
# ====================================================
[MappingApplication_occupancyGrid_00_insertOpts]
mapAltitude=0
useMapAltitude=0
maxDistanceInsertion=10          # YDLidar X4 Pro max range (30m->10m)
maxOccupancyUpdateCertainty=0.65 # Artırıldı (0.54->0.65, daha kesin güncelleme)
considerInvalidRangesAsFreeSpace=1
minLaserScanNoiseStd=0.001

wideningBeamsWithDistance=1

# Ray tracing parameters - büyük robot için
decimation=1                     # Her ışını kullan
horizontalTolerance=0.000873     # ~0.05 derece (hassasiyet için)

# Robot size consideration - çarpışma kontrolü için
occupiedThreshold=0.6            # Dolu hücre threshold
freeThreshold=0.2               # Boş hücre threshold

# ====================================================
# Likelihood Options - Encoder odometry ile optimize
# ====================================================
[MappingApplication_occupancyGrid_00_likelihoodOpts]
likelihoodMethod=4              # LF_Trun (encoder ile en iyi)
LF_decimation=2                 # 4'ten 2'ye (daha hassas)
LF_stdHit=0.08                 # YDLidar noise için artırıldı (0.05->0.08)
LF_maxCorrsDistance=0.30       # Azaltıldı (0.50->0.30, encoder güvenilir)
LF_zHit=0.995                  # Biraz azaltıldı (0.999->0.995)
LF_zRandom=0.005               # Biraz artırıldı (0.001->0.005)
LF_maxRange=10                 # YDLidar X4 Pro max range
LF_alternateAverageMethod=0

enableLikelihoodCache=1

# ====================================================
# Odometry Integration Parameters
# ====================================================
[odometry_params]
# Bu parametreler motion_model bölümünde default.yaml'dan alınır
use_odometry=1                  # Encoder odometry kullan
odom_topic="/odom"             # Odometry topic
max_odom_linear_vel=2.0        # Max linear velocity (m/s)
max_odom_angular_vel=1.5       # Max angular velocity (rad/s)

# Odometry validation - encoder verisi doğrulama
validate_odometry=1
max_odom_jump_linear=0.5       # Max linear jump (50cm)
max_odom_jump_angular=0.5      # Max angular jump (0.5 rad ≈ 28°)
